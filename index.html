
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Matrices por Terminal</title>
    <style>
        body {
            background-color: #000;
            font-family: monospace;
            color: #0f0;
            padding: 20px;
        }
        h2 {
            margin: 30px 0 10px;
            font-size: 1.5rem;
            text-align: center;
        }
        table {
            margin: 0 auto 40px auto;
            border-collapse: collapse;
            color: #0f0;
            width: 100%;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #0f0;
            padding: 10px;
            text-align: center;
            font-size: 1rem;
            word-wrap: break-word;
            cursor: pointer;
        }
        th {
            background-color: #111;
        }
        .ok { background-color: #0f0; color: #000; }
        .warn { background-color: #ff0; color: #000; }
        .low { background-color: #f00; color: #fff; }
        .empty { background-color: #333; color: #888; }
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #111;
            border: 2px solid #0f0;
            padding: 20px;
            color: #0f0;
            max-width: 90%;
            font-size: 1.2rem;
            line-height: 1.5;
        }
        .modal-content p { margin: 8px 0; }
        .close-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            color: #0f0;
            font-size: 20px;
            cursor: pointer;
        }
        @media (max-width: 768px) {
            th, td {
                font-size: 0.8rem;
                padding: 6px;
            }
        }
    </style>
</head>
<body>

<div id="info-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="document.getElementById('info-modal').style.display='none'">&times;</span>
        <h3>Detalles del Par</h3>
        <div id="modal-body"></div>
    </div>
</div>

<table id="matrix-table"></table>

<script>
    let matrixData = "{\r\n   \"Respuesta\": [ {\r\n      \"tipoPrueba\":\"porTerminal\",\r\n      \"fechaInicio\":\"2025-04-08 12:20:40\",\r\n      \"fechaFin\":\"2025-04-08 12:21:29\",\r\n      \"terminal\":\"BUR0036FOA1\",\r\n      \"cantidadPares\":8,\r\n      \"puertoPON\":\"BCNHGOR02118BUR0036F\",\r\n      \"par1\":{\r\n         \"telefono\":\"6865545189\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"SCOM218163F8\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-1\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par2\":{\r\n         \"telefono\":\"6868426271\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1367\",\r\n         \"serieModem\":\"ZXYG162653A2\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-2\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par3\":{\r\n         \"telefono\":\"6868432422\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTCE313C0A3\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-3\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par4\":{\r\n         \"telefono\":\"6865525686\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"SCOM21707567\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-4\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par5\":{\r\n         \"telefono\":\"6865543547\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"SCOM2286445A\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-5\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par6\":{\r\n         \"telefono\":\"6865141561\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTC6C9DD19E\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-6\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par7\":{\r\n         \"telefono\":\"6865545397\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTCDE8810A2\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-7\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par8\":{\r\n         \"telefono\":\"6865522084\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTC1A069A9E\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-8\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      }\r\n   } , {\r\n      \"tipoPrueba\":\"porTerminal\",\r\n      \"fechaInicio\":\"2025-04-08 12:24:10\",\r\n      \"fechaFin\":\"2025-04-08 12:25:02\",\r\n      \"terminal\":\"BUR0036FOA8\",\r\n      \"cantidadPares\":8,\r\n      \"puertoPON\":\"BCNHGOR02118BUR0036F\",\r\n      \"par57\":{\r\n         \"telefono\":\"6865524574\",\r\n         \"estadoOperativo\":\"Up\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":-22.359999999999999,\r\n         \"clasificacionPotencia\":\"Buena recepcion\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTC7F90699E\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-57\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par58\":{\r\n         \"telefono\":\"6865659510\",\r\n         \"estadoOperativo\":\"Up\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":-26.990000000000002,\r\n         \"clasificacionPotencia\":\"Parametros en limite\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTC7F04B69E\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-58\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par59\":{\r\n         \"telefono\":\"6865545100\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"SCOM207C7E84\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-59\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par60\":{\r\n         \"telefono\":\"6865543672\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"SCOM201032FB\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-60\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par61\":{\r\n         \"telefono\":\"6865546572\",\r\n         \"estadoOperativo\":\"Up\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":-19.830000000000002,\r\n         \"clasificacionPotencia\":\"Buena recepcion\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTC933A269E\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-61\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par62\":{\r\n         \"telefono\":\"6865547203\",\r\n         \"estadoOperativo\":\"Up\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":-26.990000000000002,\r\n         \"clasificacionPotencia\":\"Parametros en limite\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTC9302559E\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-62\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par63\":{\r\n         \"telefono\":\"6865544692\",\r\n         \"estadoOperativo\":\"Up\",\r\n         \"estadoAdministrativo\":\"Up\",\r\n         \"potenciaOptica\":-18.120000000000001,\r\n         \"clasificacionPotencia\":\"Buena recepcion\",\r\n         \"vlan\":\"1759\",\r\n         \"serieModem\":\"HWTC54E8549E\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-63\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      },\r\n      \"par64\":{\r\n         \"telefono\":\"\",\r\n         \"estadoOperativo\":\"Down\",\r\n         \"estadoAdministrativo\":\"Down\",\r\n         \"potenciaOptica\":\"\",\r\n         \"clasificacionPotencia\":\"Parametro fuera de rango\",\r\n         \"vlan\":\"\",\r\n         \"serieModem\":\"\",\r\n         \"dropID\":\"BCNGGONZALEZORTEG-02:0-0-17-6-64\",\r\n         \"codigo\":\"000\",\r\n         \"descripcion\":\"EXITO\"\r\n      }\r\n   }\r\n   ]\r\n}\r\n";
    matrixData = JSON.parse(matrixData);
</script>

<script>
    const respuestas = matrixData.Respuesta || [];
    const table = document.getElementById("matrix-table");

    const potenciaColor = (clasificacion) => {
        const value = (clasificacion || '').toLowerCase();
        if (value.includes('buena')) return 'ok';
        if (value.includes('limite')) return 'warn';
        if (value.includes('fuera')) return 'low';
        return 'empty';
    };

    const showModal = (par, terminal = '', parLabel = '') => {
        const modal = document.getElementById("info-modal");
        const body = document.getElementById("modal-body");
        body.innerHTML = `
            <p><strong>🖥️ Terminal:</strong> ${terminal || '—'}</p>
            <p><strong>🔢 Par:</strong> ${parLabel || '—'}</p>
            <p><strong>📞 Teléfono:</strong> ${par?.telefono || '—'}</p>
            <p><strong>📶 Estado Operativo:</strong> ${par?.estadoOperativo || '—'}</p>
            <p><strong>🛠 Estado Administrativo:</strong> ${par?.estadoAdministrativo || '—'}</p>
            <p><strong>🔦 Potencia Óptica:</strong> ${par?.potenciaOptica || '—'}</p>
            <p><strong>⚙ Clasificación:</strong> ${par?.clasificacionPotencia || '—'}</p>
            <p><strong>🛜 VLAN:</strong> ${par?.vlan || '—'}</p>
            <p><strong>🔧 Serie Módem:</strong> ${par?.serieModem || '—'}</p>
            <p><strong>🧵 Drop ID:</strong> ${par?.dropID || '—'}</p>
            <p><strong>🧾 Código:</strong> ${par?.codigo || '—'}</p>
            <p><strong>📋 Descripción:</strong> ${par?.descripcion || '—'}</p>
        `;
        modal.style.display = 'flex';
    };

    let maxColumns = 0;
    const terminalParKeys = respuestas.map(respuesta => {
        const keys = Object.keys(respuesta)
            .filter(k => /^par\d+$/i.test(k))
            .sort((a, b) => parseInt(a.replace('par', '')) - parseInt(b.replace('par', '')));
        maxColumns = Math.max(maxColumns, keys.length);
        return keys;
    });

    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headerRow.innerHTML = `<th></th>`;
    for (let i = 1; i <= maxColumns; i++) {
        const th = document.createElement("th");
        th.textContent = i;
        headerRow.appendChild(th);
    }
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");

    respuestas.forEach((respuesta, index) => {
        const terminal = respuesta.terminal || `Terminal ${index + 1}`;
        const suffix = terminal.split("FO")[1] || '?';
        const row = document.createElement("tr");
        const tdHeader = document.createElement("td");
        tdHeader.innerHTML = `<strong>${suffix}</strong>`;
        tdHeader.onclick = () => showModal(null, terminal);
        row.appendChild(tdHeader);

        const parKeys = terminalParKeys[index];

        for (let i = 0; i < maxColumns; i++) {
            const key = parKeys[i];
            const par = key ? respuesta[key] : null;
            const td = document.createElement("td");

            if (par) {
                const potencia = par.potenciaOptica;
                let display = potencia;
                if (potencia !== '' && !isNaN(potencia)) {
                    display = parseFloat(potencia).toFixed(2);
                }
                td.textContent = display || '—';
                td.className = potenciaColor(par.clasificacionPotencia);
                td.onclick = () => showModal(par, terminal, key.replace('par', ''));
            } else {
                td.textContent = '—';
                td.className = 'empty';
            }

            row.appendChild(td);
        }

        tbody.appendChild(row);
    });

    table.appendChild(tbody);

    window.onclick = (event) => {
        const modal = document.getElementById("info-modal");
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>
