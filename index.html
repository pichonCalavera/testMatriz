<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Matrices por Terminal</title>
    <style>
        body {
            background-color: #000;
            font-family: monospace;
            color: #0f0;
            padding: 20px;
        }
        h2 {
            margin: 30px 0 10px;
            font-size: 1.5rem;
            text-align: center;
        }
        .metadata {
            text-align: center;
            margin-bottom: 10px;
        }
        table {
            margin: 0 auto 40px auto;
            border-collapse: collapse;
            color: #0f0;
            width: auto;
        }
        th, td {
            border: 1px solid #0f0;
            padding: 10px;
            min-width: 60px;
            text-align: center;
            font-size: 1rem;
        }
        th {
            background-color: #111;
        }
        .ok { background-color: #0f0; color: #000; }
        .warn { background-color: #ff0; color: #000; }
        .low { background-color: #f00; color: #fff; }
        .empty { background-color: #333; color: #888; }
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #111;
            border: 2px solid #0f0;
            padding: 20px;
            color: #0f0;
            max-width: 90%;
            font-size: 1.2rem;
            line-height: 1.5;
        }
        .modal-content p { margin: 8px 0; }
        .close-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            color: #0f0;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="container"></div>

<div id="info-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="document.getElementById('info-modal').style.display='none'">&times;</span>
        <h3>Detalles del Par</h3>
        <div id="modal-body"></div>
    </div>
</div>

<script>
    // Replace with your actual JSON or inject with Thymeleaf
    const matrixData = {
        "Respuesta": [ {
      "tipoPrueba":"porTerminal",
      "fechaInicio":"2025-04-08 12:20:40",
      "fechaFin":"2025-04-08 12:21:29",
      "terminal":"BUR0036FOA1",
      "cantidadPares":8,
      "puertoPON":"BCNHGOR02118BUR0036F",
      "par1":{
         "telefono":"6865545189",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"SCOM218163F8",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-1",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par2":{
         "telefono":"6868426271",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1367",
         "serieModem":"ZXYG162653A2",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-2",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par3":{
         "telefono":"6868432422",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"HWTCE313C0A3",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-3",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par4":{
         "telefono":"6865525686",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"SCOM21707567",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-4",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par5":{
         "telefono":"6865543547",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"SCOM2286445A",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-5",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par6":{
         "telefono":"6865141561",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"HWTC6C9DD19E",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-6",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par7":{
         "telefono":"6865545397",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"HWTCDE8810A2",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-7",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par8":{
         "telefono":"6865522084",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"HWTC1A069A9E",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-8",
         "codigo":"000",
         "descripcion":"EXITO"
      }
   } , {
      "tipoPrueba":"porTerminal",
      "fechaInicio":"2025-04-08 12:24:10",
      "fechaFin":"2025-04-08 12:25:02",
      "terminal":"BUR0036FOA8",
      "cantidadPares":8,
      "puertoPON":"BCNHGOR02118BUR0036F",
      "par57":{
         "telefono":"6865524574",
         "estadoOperativo":"Up",
         "estadoAdministrativo":"Up",
         "potenciaOptica":-22.359999999999999,
         "clasificacionPotencia":"Buena recepcion",
         "vlan":"1759",
         "serieModem":"HWTC7F90699E",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-57",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par58":{
         "telefono":"6865659510",
         "estadoOperativo":"Up",
         "estadoAdministrativo":"Up",
         "potenciaOptica":-26.990000000000002,
         "clasificacionPotencia":"Parametros en limite",
         "vlan":"1759",
         "serieModem":"HWTC7F04B69E",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-58",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par59":{
         "telefono":"6865545100",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"SCOM207C7E84",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-59",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par60":{
         "telefono":"6865543672",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Up",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"1759",
         "serieModem":"SCOM201032FB",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-60",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par61":{
         "telefono":"6865546572",
         "estadoOperativo":"Up",
         "estadoAdministrativo":"Up",
         "potenciaOptica":-19.830000000000002,
         "clasificacionPotencia":"Buena recepcion",
         "vlan":"1759",
         "serieModem":"HWTC933A269E",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-61",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par62":{
         "telefono":"6865547203",
         "estadoOperativo":"Up",
         "estadoAdministrativo":"Up",
         "potenciaOptica":-26.990000000000002,
         "clasificacionPotencia":"Parametros en limite",
         "vlan":"1759",
         "serieModem":"HWTC9302559E",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-62",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par63":{
         "telefono":"6865544692",
         "estadoOperativo":"Up",
         "estadoAdministrativo":"Up",
         "potenciaOptica":-18.120000000000001,
         "clasificacionPotencia":"Buena recepcion",
         "vlan":"1759",
         "serieModem":"HWTC54E8549E",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-63",
         "codigo":"000",
         "descripcion":"EXITO"
      },
      "par64":{
         "telefono":"",
         "estadoOperativo":"Down",
         "estadoAdministrativo":"Down",
         "potenciaOptica":"",
         "clasificacionPotencia":"Parametro fuera de rango",
         "vlan":"",
         "serieModem":"",
         "dropID":"BCNGGONZALEZORTEG-02:0-0-17-6-64",
         "codigo":"000",
         "descripcion":"EXITO"
      }
   }
   ]
    };

    const respuestas = matrixData.Respuesta || [];
    const container = document.getElementById("container");

    const potenciaColor = (clasificacion) => {
        const value = (clasificacion || '').toLowerCase();
        if (value.includes('buena')) return 'ok';
        if (value.includes('limite')) return 'warn';
        if (value.includes('fuera')) return 'low';
        return 'empty';
    };

    const showModal = (par) => {
        const modal = document.getElementById("info-modal");
        const body = document.getElementById("modal-body");
        body.innerHTML = `
            <p><strong>📞 Teléfono:</strong> ${par.telefono || '—'}</p>
            <p><strong>📶 Estado Operativo:</strong> ${par.estadoOperativo || '—'}</p>
            <p><strong>🛠 Estado Administrativo:</strong> ${par.estadoAdministrativo || '—'}</p>
            <p><strong>🔦 Potencia Óptica:</strong> ${par.potenciaOptica || '—'}</p>
            <p><strong>⚙ Clasificación:</strong> ${par.clasificacionPotencia || '—'}</p>
            <p><strong>🛜 VLAN:</strong> ${par.vlan || '—'}</p>
            <p><strong>🔧 Serie Módem:</strong> ${par.serieModem || '—'}</p>
            <p><strong>🧵 Drop ID:</strong> ${par.dropID || '—'}</p>
            <p><strong>🧾 Código:</strong> ${par.codigo || '—'}</p>
            <p><strong>📋 Descripción:</strong> ${par.descripcion || '—'}</p>
        `;
        modal.style.display = 'flex';
    };

    const parKeys = [...new Set(
        respuestas.flatMap(r =>
            Object.keys(r).filter(k => /^par\\d+$/i.test(k))
        )
    )].sort((a, b) => parseInt(a.replace('par', '')) - parseInt(b.replace('par', '')));


    // Create table with shared headers
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headerRow.innerHTML = `<th></th>`;
    parKeys.forEach((_, i) => {
        const th = document.createElement("th");
        th.textContent = i + 1;
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");

    respuestas.forEach((respuesta, index) => {
        const terminal = respuesta.terminal || `Terminal ${index + 1}`;
        const suffix = terminal.split("FO")[1] || '?';

        const title = document.createElement("h2");
        title.textContent = `Terminal: ${terminal}`;
        container.appendChild(title);

        const metadata = document.createElement("div");
        metadata.className = "metadata";
        metadata.innerHTML = `<p><strong>Fecha de Inicio:</strong> ${respuesta.fechaInicio || 'N/A'}</p>`;
        container.appendChild(metadata);

        const row = document.createElement("tr");
        row.innerHTML = `<td><strong>${suffix}</strong></td>`;
        parKeys.forEach(k => {
            const par = respuesta[k] || {};
            const potencia = par.potenciaOptica;
            let display = potencia;
            if (potencia !== '' && !isNaN(potencia)) {
                display = parseFloat(potencia).toFixed(2);
            }
            const td = document.createElement("td");
            td.textContent = display || '—';
            td.className = potenciaColor(par.clasificacionPotencia);
            td.onclick = () => showModal(par);
            row.appendChild(td);
        });
        tbody.appendChild(row);
    });

    table.appendChild(tbody);
    container.appendChild(table);

    window.onclick = (event) => {
        const modal = document.getElementById("info-modal");
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>
